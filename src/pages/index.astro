---
import '../styles/global.css';
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Snow</title>
	</head>
	<body class="bg-black min-h-screen overflow-hidden flex items-center justify-center">
		<canvas id="snow"></canvas>
		<div class="relative z-10 border-2 border-gray-500 w-[70vw] h-[60vh]">
			<div class="absolute top-8 left-8">
				<img 
					src="/assets/âœ§.jpg" 
					alt="Profile" 
					class="w-32 h-32 object-cover border-4 border-white/30"
				/>
			</div>
			<div class="absolute top-8 left-48 text-white" style="font-family: Consolas, monospace; font-size: 16px; line-height: 16px;">
				<span>anti</span>
				<span class="mx-2 text-gray-500">|</span>
				<span>femboy</span>
				<span class="mx-2 text-gray-500">|</span>
				<span>developer</span>
			</div>
			<div class="absolute top-48 left-8 text-white max-w-xl" style="font-family: Consolas, monospace; font-size: 16px; line-height: 24px;">
				<p>hi im anti / koi / or whatever else you know me by</p>
				<p>im a full stack developer with over 4+ years of experience</p>
				<p>my main languages i currently use are Typescript python C++ Java</p>
				<p>uhh im employed yea bye ;3</p>
			</div>
			<div class="absolute top-80 left-8 flex gap-4">
				<img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/typescript/typescript-original.svg" alt="TypeScript" class="w-12 h-12" />
				<img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/python/python-original.svg" alt="Python" class="w-12 h-12" />
				<img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/cplusplus/cplusplus-original.svg" alt="C++" class="w-12 h-12" />
				<img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/java/java-original.svg" alt="Java" class="w-12 h-12" />
			</div>
			<div class="absolute bottom-8 left-8 text-white" style="font-family: Consolas, monospace; font-size: 16px; line-height: 24px;">
				<p class="mb-2 text-gray-400">socials:</p>
				<p>email: tomlovesbdg@gmail.com</p>
				<p>discord: antidotxe</p>
				<p>github: <a href="https://github.com/antidotxe" target="_blank" class="text-blue-400 hover:text-blue-300 underline">https://github.com/antidotxe</a></p>
			</div>
			<div id="spotify" class="absolute bottom-8 right-8 text-white" style="font-family: Consolas, monospace; font-size: 14px; line-height: 20px;">
				<p class="text-gray-400 mb-2">currently listening to:</p>
				<div id="spotify-content" class="flex items-center gap-3">
					<p class="text-gray-500">loading...</p>
				</div>
			</div>
		</div>
	</body>
</html>

<style>
	#snow {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
	}
</style>

<script>
	const canvas = document.getElementById('snow') as HTMLCanvasElement;
	const ctx = canvas.getContext('2d')!;

	canvas.width = window.innerWidth;
	canvas.height = window.innerHeight;

	interface Snowflake {
		x: number;
		y: number;
		radius: number;
		speed: number;
		drift: number;
	}

	const snowflakes: Snowflake[] = [];
	const snowflakeCount = 150;

	for (let i = 0; i < snowflakeCount; i++) {
		snowflakes.push({
			x: Math.random() * canvas.width,
			y: Math.random() * canvas.height,
			radius: Math.random() * 2 + 1,
			speed: Math.random() * 1 + 0.5,
			drift: Math.random() * 0.5 - 0.25
		});
	}

	function animate() {
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		ctx.fillStyle = 'white';

		snowflakes.forEach(flake => {
			ctx.beginPath();
			ctx.arc(flake.x, flake.y, flake.radius, 0, Math.PI * 2);
			ctx.fill();

			flake.y += flake.speed;
			flake.x += flake.drift;

			if (flake.y > canvas.height) {
				flake.y = -10;
				flake.x = Math.random() * canvas.width;
			}

			if (flake.x > canvas.width) {
				flake.x = 0;
			} else if (flake.x < 0) {
				flake.x = canvas.width;
			}
		});

		requestAnimationFrame(animate);
	}

	animate();

	window.addEventListener('resize', () => {
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;
	});

	// Spotify integration
	async function updateSpotify() {
		try {
			const response = await fetch('/api/spotify');
			const data = await response.json();
			const content = document.getElementById('spotify-content');
			
			if (data.isPlaying && content) {
				content.innerHTML = `
					<img src="${data.albumImageUrl}" alt="Album" class="w-12 h-12 object-cover" />
					<div>
						<a href="${data.songUrl}" target="_blank" class="text-white hover:text-blue-400">
							<p class="font-semibold">${data.title}</p>
							<p class="text-gray-400 text-sm">${data.artist}</p>
						</a>
					</div>
				`;
			} else if (content) {
				content.innerHTML = '<p class="text-gray-500">not playing anything</p>';
			}
		} catch (error) {
			console.error('Error fetching Spotify data:', error);
			const content = document.getElementById('spotify-content');
			if (content) {
				content.innerHTML = '<p class="text-gray-500">offline</p>';
			}
		}
	}

	updateSpotify();
	setInterval(updateSpotify, 30000); // Update every 30 seconds

</script>
